<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blog — Trading Tutor</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="../static/CSS/styles.css">
  <link rel="stylesheet" href="../static/CSS/Blog.css">

</head>
<body>

  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo"><i class="fa-solid fa-chart-line"></i></div>
        <div>
          <div class="brand-title">Trading Tutor</div>
          <div class="brand-sub">Learn • Practice • Grow</div>
        </div>
      </div>
 <nav class="nav-links">
        <a href="/">Home</a>
        <a href="{{url_for('main.dashboard')}}" class="active">Dashboard</a>
        <a href="{{url_for('main.blog')}}">Blog</a>
        <a href="{{url_for('main.workshop')}}">Workshop</a>
        <a href="{{url_for('main.contact')}}">Contact</a>

        <div class="mobile-actions">
          <a href="{{url_for('main.login')}}"class="btn btn-secondary mobile-only">Sign in</a>
          <a href="{{url_for('main.signup')}}" class="btn btn-primary mobile-only">Create account</a>
        </div>

      <div class="actions">
        <div class="theme-toggle">
          <button id="theme-btn" aria-label="Toggle Theme">
            <i class="fa-solid fa-moon"></i>
          </button>
        </div>

        <button id="menu-btn" class="icon-btn" aria-label="Menu">
          <i class="fa-solid fa-bars"></i>
        </button>
        <a class="btn btn-secondary desktop-only" href="login.html">Sign in</a>
        <a class="btn btn-primary desktop-only" href="signup.html">Create account</a>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top: 2rem;">
    <h2>Community Blogs</h2>
    <p class="muted">Share your strategies, insights, and trading journey.</p>
     
    <div class="card blog-form-card" style="margin-top: 2rem;">
      <h3>Write a New Blog Post</h3>
      <form id="blogForm" method="post" action="/blog">
        <label for="blogTitle">Title</label>
        <input type="text" id="blogTitle" name="title"  placeholder="Your amazing blog title" required>
        
        <label for="blogContent">Content</label>
        <textarea id="blogContent" name="content" placeholder="Write your blog here..." required rows="6"></textarea>
        
        <button class="btn btn-primary" type="submit">Publish Post</button>
      </form>
    </div>

  <h2 style="margin-top: 3rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
    Recent Posts
</h2>

<div id="blogList" class="blog-grid" style="margin-top: 1.5rem;">
  {% if blogs %}
    {% for blog in blogs %}
      <div class="card blog-card" data-id="{{ blog.id }}">
          <!-- Dynamic image: use user's Google image or placeholder -->
          <img src="{{ blog.image_url }}" class="blog-thumb" alt="Blog Image">

          <div class="blog-content">
              <!-- Blog title -->
              <h3 class="blog-card-title">{{ blog.title }}</h3>

              <!-- Snippet for preview -->
              <p class="blog-card-snippet">{{ blog.content[:100] }}... (click read more)</p>

              <!-- Full content hidden by default -->
              <p class="blog-card-full-content" style="display: none;">{{ blog.content }}</p>

              <!-- Author and date -->
              <p class="muted blog-meta">By {{ blog.author_name }} • {{ blog.created_at[:10] }}</p>

              <!-- Actions -->
              <div class="blog-actions">
                  <a href="#" class="btn btn-secondary read-more-btn">Read More</a>

                  <!-- Like button (everyone can see) -->
                  <button class="btn btn-outline like-btn">
                      <i class="fa-regular fa-heart"></i> <span>{{ blog.likes or 0 }}</span>
                  </button>

                  <!-- Edit button: only for the blog author -->
                  {% if session.get('user_name') == blog.author_name %}
                      <a href="{{ url_for('main.edit_blog', blog_id=blog.id) }}" class="btn btn-outline edit-btn">Edit</a>
                  {% endif %}

                  <!-- Delete button: for author or admin -->
                  {% if session.get('user_name') == blog.author_name or session.get('admin_name') %}
                      <form method="POST" action="{{ url_for('main.delete_blog', blog_id=blog.id) }}" style="display:inline;">
                          <button type="submit" class="btn btn-outline delete-btn">Delete</button>
                      </form>
                  {% endif %}
              </div>
          </div>
      </div>
    {% endfor %}
  {% else %}
    <p>No blog posts yet. Be the first to write one!</p>
  {% endif %}
</div>


  </main>

  <div id="blogModal" class="modal-overlay">
  <div class="modal-card">
    <button id="modalCloseBtn" class="modal-close-btn">&times;</button>
    <img src="" id="modalImage" class="modal-image" alt="Blog Post Image">
    <div class="modal-content">
      <h2 id="modalTitle"></h2>
      <p id="modalFullContent"></p>

      <div class="modal-like-bar">
  <button class="btn btn-primary like-btn">
    <i class="fa-regular fa-heart"></i> <span>Like (0)</span>
  </button>
</div>

     
  </div>

      <p id="modalFullContent"></p>
    </div>
  </div>
</div>

<footer>
    <div class="container footer-inner">
      <div>
        <h6>Trading Tutor</h6>
        <p class="muted">Learn • Practice • Grow</p>
      </div>
      <div>
        <h6>Explore</h6>
        <a href="{{url_for('main.home')}}">Home</a><br>
        <a href="{{ url_for('main.dashboard' )}}">Dashboard</a><br>
        <a href="{{url_for('main.blog')}}">Blog</a><br>
        <a href="{{url_for('main.workshop')}}">Workshop</a><br>
      </div>
      <div>
        <h6>Support</h6>
        <a href="{{url_for('main.contact')}}">Contact</a><br>
        <a href="{{url_for('main.forgot_password')}}">Reset Password</a><br>
      </div>
      <div>
        <h6>Legal</h6>
        <a href="#">Terms</a><br>
        <a href="#">Privacy</a><br>
      </div>
    </div>
    <div class="container footer-bottom">
      <div>© <span id="year"></span> Trading Tutor</div>
      <div class="socials">
        <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
        <a href="#"><i class="fa-brands fa-linkedin"></i></a>
        <a href="#"><i class="fa-brands fa-github"></i></a>
      </div>
    </div>
  </footer>

  <script src="../static/JS/scripts.js"></script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".like-btn").forEach(btn => {
        btn.addEventListener("click", async (e) => {
            const card = e.target.closest(".blog-card");
            const blogId = card.dataset.id;

            const response = await fetch(`/blog/like/${blogId}`, { method: "POST" });
            const data = await response.json();

            if (data.success) {
                btn.querySelector("span").textContent = data.new_likes;
            } else {
                alert(data.error);
            }
        });
    });
});
</script>
</body>
</html>